<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Android Gradle 入门 | 飞雪无情的博客</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/pure-min.css"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Android Gradle 入门</h1><a id="logo" href="/.">飞雪无情的博客</a><p class="description">专注于Android、Java、移动互联网、项目管理、软件架构</p></div><div id="nav-menu"><a href="/." class="current"><i class="icon-home"> 首页</i></a><a href="/books/"><i class="icon-history"> 新书</i></a><a href="/archives/"><i class="icon-archive"> 归档</i></a><a href="/about/"><i class="icon-about"> 关于</i></a><a href="/atom.xml"><i class="icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">Android Gradle 入门</h1><div class="post-meta">2016-04-11 | <span class="categories">分类于<a href="/categories/Android/"> Android</a><a href="/categories/Android/Gradle/"> Gradle</a></span></div><span data-thread-key="2016/04/11/android-gradle-getting-started.html" class="ds-thread-count"></span><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#配置Gradle环境"><span class="toc-number">1.</span> <span class="toc-text">配置Gradle环境</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Linux下搭建Gradle构建环境"><span class="toc-number">1.1.</span> <span class="toc-text">Linux下搭建Gradle构建环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Window下搭建Gradle构建环境"><span class="toc-number">1.2.</span> <span class="toc-text">Window下搭建Gradle构建环境</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Gradle版Hello_World"><span class="toc-number">2.</span> <span class="toc-text">Gradle版Hello World</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Gradle_Wrapper"><span class="toc-number">3.</span> <span class="toc-text">Gradle Wrapper</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#生成wrapper"><span class="toc-number">3.1.</span> <span class="toc-text">生成wrapper</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#wrapper配置"><span class="toc-number">3.2.</span> <span class="toc-text">wrapper配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gradle-wrapper-properties"><span class="toc-number">3.3.</span> <span class="toc-text">gradle-wrapper.properties</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#自定义Wrapper_Task"><span class="toc-number">3.4.</span> <span class="toc-text">自定义Wrapper Task</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Gradle日志"><span class="toc-number">4.</span> <span class="toc-text">Gradle日志</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#日志级别"><span class="toc-number">4.1.</span> <span class="toc-text">日志级别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#输出错误堆栈信息"><span class="toc-number">4.2.</span> <span class="toc-text">输出错误堆栈信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#自己使用日志信息调试"><span class="toc-number">4.3.</span> <span class="toc-text">自己使用日志信息调试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Gradle命令行"><span class="toc-number">5.</span> <span class="toc-text">Gradle命令行</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#记得使用帮助"><span class="toc-number">5.1.</span> <span class="toc-text">记得使用帮助</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查看所有可执行的Tasks"><span class="toc-number">5.2.</span> <span class="toc-text">查看所有可执行的Tasks</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gradle_help_任务"><span class="toc-number">5.3.</span> <span class="toc-text">gradle help 任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#强制刷新依赖"><span class="toc-number">5.4.</span> <span class="toc-text">强制刷新依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#多任务调用"><span class="toc-number">5.5.</span> <span class="toc-text">多任务调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#通过任务名字缩写执行执行"><span class="toc-number">5.6.</span> <span class="toc-text">通过任务名字缩写执行执行</span></a></li></ol></li></ol></div></div><div class="post-content"><p> Gradle是一款非常优秀的构建系统工具,它的DSL基于Groovy实现,可以让你很方便的通过代码控制这些DSL来达到你构建的目的，其构建的大部分功能都是通过插件的方式来实现，所以非常灵活方便，如果内置插件不能满足你的需求你可以自定义自己的插件。</p>
<p>本章我们就介绍Gradle的入门，在介绍之前，我们先假定读者已经具备以下前提：</p>
<ol>
<li>了解并且会使用Java，精通最好</li>
<li>会自己的独立的搭建Java开发环境</li>
<li>最好会使用Linux操作系统，比如Ubuntu</li>
</ol>
<p>为什么会有这样的假定呢，因为这本书是介绍Android Gradle开发构建的书，所以不会花章节去讲Java的基本知识，能希望读者会用Linux操作系统的原因，是因为作者该书的所有脚本、代码、IDE等都是基于Ubuntu完成的，当然比如涉及到Gradle安装还会介绍一下Window的安装步骤，但是不会太多涉及到Window的东西，这个关于本书一章里有提到，所以呢，还是希望读者们在阅读本书前已经掌握了这些知识，Linux操作系统非必须，因为涉及到的都是Linux很基本的东西，大家很容易就看得懂。</p>
<h3 id="配置Gradle环境">配置Gradle环境</h3><p>安装之前确保已经安装配置好Java环境，要求JDK 6以上，并且在环境变量里配置了JAVA_HOME,查看java版本可以在终端输入如下命令：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure></p>
<p>我这里使用的是open jdk 1.7.0_79。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flysnow@flysnow:~$ java -version&#10;java version &#34;1.7.0_79&#34;&#10;OpenJDK Runtime Environment (IcedTea 2.5.6) (7u79-2.5.6-0ubuntu1.15.04.1)&#10;OpenJDK 64-Bit Server VM (build 24.79-b02, mixed mode)</span><br></pre></td></tr></table></figure></p>
<h4 id="Linux下搭建Gradle构建环境">Linux下搭建Gradle构建环境</h4><p>这里以Ubuntu 15.04发行版为例介绍如何在Linux搭建Gradle构建环境，其他注入CentOS大同小异，参考下就可以了。</p>
<p>我们这里以Gradle 2.5版本为准进行介绍，先到Gradle官网 <a href="http://gradle.org/下载好Gradle" target="_blank" rel="external">http://gradle.org/下载好Gradle</a> SDK，直接下载地址为 <a href="https://downloads.gradle.org/distributions/gradle-2.5-all.zip，我们下载的是all版本，也就是说，里面包含了Gradle" target="_blank" rel="external">https://downloads.gradle.org/distributions/gradle-2.5-all.zip，我们下载的是all版本，也就是说，里面包含了Gradle</a> SDK所有相关的内容，包括源代码、文档、示例等。下载之后进行解压，我们可以得到如何目录清单：</p>
<ol>
<li>docs——API、DSL、指南等文档</li>
<li>getting-started.html——入门链接</li>
<li>init.d——gradle的初始化脚本目录</li>
<li>lib——相关库</li>
<li>LICENSE</li>
<li>media——一些icon资源</li>
<li>NOTICE</li>
<li>samples——示例</li>
<li>src——源文件</li>
</ol>
<p>要运行Gradle，必须把GRADLE_HOME/bin目录添加到你的环境变量PATH的路径里才可以。在Linux下，如果你只想为你当前登陆的用户配置可以运行Gradle，那么可以编辑～/.bashrc文件添加以下内容：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#36825;&#37324;&#26159;&#20316;&#32773;&#30340;Gradle&#30446;&#24405;&#12290;&#35201;&#25442;&#25104;&#20320;&#33258;&#24049;&#30340;&#10;GRADLE_HOME=/home/flysnow/frame/gradle&#10;          &#10;PATH=$&#123;PATH&#125;:$&#123;GRADLE_HOME&#125;/bin&#10;exportGRADLE_HOME PATH</span><br></pre></td></tr></table></figure></p>
<p>上面GRADLE_HOME是我的Gradle解压后的目录，这里要换成你自己的。以上添加后保存，然后在终端输入source ~/.bashrc回车执行让刚刚的配置生效。</p>
<p>如果你想让所有用户都可以使用gradle，那么你就需要在/etc/profile中添加以上内容，在这里添加后，对所有用户都生效，这种方式的添加，必须要重启电脑才可以。</p>
<p>好了，现在我们已经配置好了，要进行验证我们的配置是否正确，是否可以运行gradle，我们只需要打开终端，输入gradle -v命令查看即可，如果能正确显示gradle版本号、Groovy版本号、JVM等相关信息，那么说明你已经配置成功了，这里以我的为例：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gradle -v&#10;          &#10;------------------------------------------------------------&#10;Gradle 2.5&#10;------------------------------------------------------------&#10;           &#10;Build time:   2015-07-08 07:38:37 UTC&#10;Build number: none&#10;Revision:     093765bccd3ee722ed5310583e5ed140688a8c2b&#10;           &#10;Groovy:       2.3.10&#10;Ant:          Apache Ant(TM) version 1.9.3 compiled on December 23 2013&#10;JVM:          1.7.0_79 (Oracle Corporation 24.79-b02)&#10;OS:           Linux 3.19.0-28-generic amd64</span><br></pre></td></tr></table></figure></p>
<h4 id="Window下搭建Gradle构建环境">Window下搭建Gradle构建环境</h4><p>Window下搭建Gradle环境和Linux非常相似，只不过方式不同。我们通过右击我的电脑，打开属性面板，然后找到环境变量配置项，添加GRADLE_HOME环境变量，然后把GRADLE_HOME\bin添加到PATH系统变量里保存即可。完成后打开CMD运行gradle -v来进行验证，整体和Linux差不多，这里就不在一一详述。</p>
<h3 id="Gradle版Hello_World">Gradle版Hello World</h3><p>环境搭建好了，那么我们就开始写一个Hello World版的Gradle脚本吧。</p>
<p>新建好一个目录，我这里是android-gradle-book-code，然后在该目录下创建一个名为build.gradle的文件，打开编辑该文件，输入以下内容：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">task hello&#123;</span><br><span class="line">    doLast&#123;</span><br><span class="line">        println<span class="string">'Hello World!'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>打开终端，然后移动到android-gradle-book-code下，使用gradle -q hello命令来执行构建脚本：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gradle -q hello&#10;Hello World!</span><br></pre></td></tr></table></figure></p>
<p>好了，如愿以偿的打印出来我们想要的结果，下面我们一步步分析结果产生的步骤和原因。build.gradle是Gradle默认的构建脚本文件，执行Gradle命令的时候，会默认加载当前目录下的build.gradle脚本文件，熟悉Ant的同学感觉和build.xml差不多，当然你也可以通过 -b 参数指定想要加载执行的文件。</p>
<p>这个构建脚本定义一个任务（Task），任务名字叫hello，并且给任务hello添加了一个动作，官方名字是Action，阅读Gradle源代码你会到处见到它，其实他就是一段Groovy语言实现的闭包，在这里我觉得叫业务代码逻辑或者回调实现更贴切一些，因为doLast就意味着在Task执行完毕之后要回调doLast的这部分闭包的代码实现。</p>
<p>熟悉Ant的读者，会觉得任务(Task)和Ant里的Target(目标)非常相似，其实没错，现在可以认为他们基本上相同。</p>
<p>再看gradle -q hello这段运行命令，意思是要执行build.gradle脚本中定义的名为hello的Task，-q参数用于控制gradle输出的日志级别，哪些日志可以输出被看到。</p>
<p>看到println ‘Hello World!’了吗，他会输出Hello World!，通过名字相信大家已经猜出来了，它其实就是System.out.println(“Hello World!”)的简写方式。Gradle可以识别它，是因为Groovy已经把println()这个方法添加到iava.lang.Object，而在Groovy中，方法的调用可以省略签名中的括号，以一个空格分开即可，所以就有了上面的写法。还有一点要说明的就是在Groovy中，单引号和双引号所包含的内容都是字符串，不像Java中，单引号是字符，双引号才是字符串。</p>
<h3 id="Gradle_Wrapper">Gradle Wrapper</h3><p>Wrapper，顾名思义，其实就是对Gradle的一层包装，便于在团队开发过程中统一Gradle构建的版本，这样大家都可以使用统一的Gradle版本进行构建，避免因为Gradle版本不统一带来的不必要的问题。</p>
<p>在这里特别介绍的目的是因为我们在项目开发过程中，用的都是wrapper这种方式，而不是我们在1.1里介绍的自己下载ZIP压缩包，配置Gradle的环境的方式。Wrapper在Window下是一个批处理脚本，在Linux下是一个shell脚本，当你使用wrapper启动Gradle的时候，wrapper会检查gradle有没有被下载关联，如果没有将会从配置的地址（一般是Gradle官方库）进行下载并运行构建。这对我们每个开发人员是非常方便的，因为你不用去专门的配置环境了，只要执行wrapper命令，它会帮你搞定一切，这样方式也方便我们在服务器上做持续集成(CI)，因为我们不用在服务器上配置Gradle环境。</p>
<h4 id="生成wrapper">生成wrapper</h4><p>Gradle提供了内置的wrapper task帮助我们自动生成wrapper所需的目录文件，在一个项目的根目录，输入gradle wrapper即可生成。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gradle wrapper&#10;:wrapper&#10;        &#10;BUILD SUCCESSFUL&#10;        &#10;Total time: 2.804 secs&#10;        &#10;This build could be faster, please consider using the Gradle Daemon: http://gradle.org/docs/2.5/userguide/gradle_daemon.html</span><br></pre></td></tr></table></figure></p>
<p>生成的文件如下：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#9500;&#9472;&#9472; gradle&#10;&#9474;   &#9492;&#9472;&#9472; wrapper&#10;&#9474;       &#9500;&#9472;&#9472; gradle-wrapper.jar&#10;&#9474;       &#9492;&#9472;&#9472; gradle-wrapper.properties&#10;&#9500;&#9472;&#9472; gradlew&#10;&#9492;&#9472;&#9472; gradlew.bat</span><br></pre></td></tr></table></figure></p>
<p>gradlew和gradlew.bat分别是Linux和Window下的可执行脚本，他们的用法和gradle原生命令是一样的，gradle怎么用，他们也就可以怎么用。gradle-wrapper.jar是具体业务逻辑实现的jar包，gradlew最终还是使用java执行的这个jar包来执行相关gradle操作。gradle-wrapper.properties是配置文件，用于配置使用哪个版本的gradle等，稍后会详细讲解。</p>
<p>这些生成的wrapper文件可以作为你项目工程的一部分提交到代码版本控制系统里(git)，这样其他开发人员就会使用这里配置好的统一的gradle进行构建开发。</p>
<h4 id="wrapper配置">wrapper配置</h4><p>当我们在终端执行gradle wrapper生成相关文件的时候，可以为其指定一些参数，来控制wrapper的生成，比如依赖的版本等。</p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>—gradle-version</td>
<td>用于指定使用的gradle版本</td>
</tr>
<tr>
<td>—gradle-distribution-url</td>
<td>用于指定下载gradle发行版的url地址</td>
</tr>
</tbody>
</table>
<p>使用方法如gradle wrapper —gradle-version 2.4这样，这样就意味着我们配置wrapper使用2.4版本的gradle，它会影响gradle-wrapper.properties中的distributionUrl的值，该值的规则是http\://services.gradle.org/distributions/gradle-${gradleVersion}-bin.zip</p>
<p>如果我们在调用gradle wrapper的时候不添加任何参数呢，那么就会使用你当前Gradle的版本作为生成的wrapper的gradle version。例如你当前安装的gradle是2.5版本的，那么生成的wrapper也是2.5版本的。</p>
<h4 id="gradle-wrapper-properties">gradle-wrapper.properties</h4><p>该配置文件是gradle wrapper的相关配置文件，我们上面执行该任务的任何配置都会被写进该文件中，现在我们来看看该文件的配置字段：</p>
<table>
<thead>
<tr>
<th>字段名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>distributionBase</td>
<td>下载的gradle压缩包解压后存储的主目录</td>
</tr>
<tr>
<td>distributionPath</td>
<td>相对于distributionBase的解压后的gradle压缩包的路径</td>
</tr>
<tr>
<td>zipStoreBase</td>
<td>同distributionBase，只不过是存放zip压缩包的</td>
</tr>
<tr>
<td>zipStorePath</td>
<td>同distributionPath，只不过是存放zip压缩包的</td>
</tr>
<tr>
<td>distributionUrl</td>
<td>gradle发行版压缩包的下载地址</td>
</tr>
</tbody>
</table>
<p>我们比较关注的就是distributionUrl这个字段了，这个决定你的gradle wrapper依赖哪个gradle版本，一般生成的都是这样的https\://services.gradle.org/distributions/gradle-2.5-bin.zip，我通常都会把bin改为all，这样在开发过程中，就可以看到gradle的源代码了。</p>
<p>基于Gradle 2.5默认生成的gradle-wrapper.properties如下：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#Wed Sep 16 23:14:52 CST 2015&#10;distributionBase=GRADLE_USER_HOME&#10;distributionPath=wrapper/dists&#10;zipStoreBase=GRADLE_USER_HOME&#10;zipStorePath=wrapper/dists&#10;distributionUrl=https\://services.gradle.org/distributions/gradle-2.5-bin.zip</span><br></pre></td></tr></table></figure></p>
<p>distributionUrl是下载gradle的路径，如果运行./gradlew的时候一直卡着不动，可能是因为官方的gradle地址被墙了，建议使用翻墙工具试试，或者把该地址换成别的镜像地址。</p>
<h4 id="自定义Wrapper_Task">自定义Wrapper Task</h4><p>前面我们讲了，gradle-wrapper.properties是由wrapper task生成的，那么我们是否可以自定义配置该Wrapper task来达到我们配置gradle-wrapper.properties的目的呢，答案是肯定的。我们在我们的build.gradle构建文件中录入如下脚本：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">task wrapper(<span class="string">type:</span> Wrapper) &#123;</span><br><span class="line">    gradleVersion = <span class="string">'2.4'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这样我们再执行gradle wrapper的时候，就会默认生成2.4版本的wrapper了，而不用使用—gradle-version 2.4进行指定了。同样你也可以配置其他参数：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">task wrapper(<span class="string">type:</span> Wrapper) &#123;</span><br><span class="line">    gradleVersion = <span class="string">'2.4'</span></span><br><span class="line">    archiveBase = <span class="string">'GRADLE_USER_HOME'</span></span><br><span class="line">    archivePath = <span class="string">'wrapper/dists'</span></span><br><span class="line">    distributionBase = <span class="string">'GRADLE_USER_HOME'</span></span><br><span class="line">    distributionPath = <span class="string">'wrapper/dists'</span></span><br><span class="line">    distributionUrl = <span class="string">'http\://services.gradle.org/distributions/gradle-2.4-all.zip'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>以上是我自己配置的一些值，也可以修改生你自己的。</p>
<h3 id="Gradle日志">Gradle日志</h3><p>在这里介绍单独介绍Gradle日志的目的是为了便于我们在遇到问题的时候，能够根据日志信息分析和解决问题。Gradle的日志和我们自己Java、Android差不多，也分一些级别，用于分类显示日志信息，这样我们只需根据不同的情况显示不同类别的信息，不至于被大量的日志搞的晕头转向。</p>
<h4 id="日志级别">日志级别</h4><p>上面提了Gradle的日志级别和大部分我们使用的语言的差不多，除了这些通用的之外，Gradle又增加了QUIET和LIFECYCLE两个级别，用于标记重要以及进度级别的日志信息。</p>
<table>
<thead>
<tr>
<th>级别</th>
<th>用于</th>
</tr>
</thead>
<tbody>
<tr>
<td>ERROR</td>
<td>错误消息</td>
</tr>
<tr>
<td>QUIET</td>
<td>重要消息</td>
</tr>
<tr>
<td>WARNING</td>
<td>警告消息</td>
</tr>
<tr>
<td>LIFECYCLE</td>
<td>进度消息</td>
</tr>
<tr>
<td>INFO</td>
<td>信息消息</td>
</tr>
<tr>
<td>DEBUG</td>
<td>调试信息</td>
</tr>
</tbody>
</table>
<p>上面的表列明确的列出了6种日志级别以及他们的作用，那么现在我们就看下怎么样使用他们。要使用他们，显示我们想要显示级别的日志，就要通过命令行选项中的日志开关来控制。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#&#36755;&#20986;QUIET&#32423;&#21035;&#21450;&#20854;&#20043;&#19978;&#30340;&#26085;&#24535;&#20449;&#24687;&#10;$ gradle -q tasks&#10;#&#36755;&#20986;INFO&#32423;&#21035;&#21450;&#20854;&#20043;&#19978;&#30340;&#26085;&#24535;&#20449;&#24687;&#10;$ gradle -i tasks</span><br></pre></td></tr></table></figure></p>
<p>以下列出所有通过命令行开关选项可以控制的级别级别，在命令行里只需加上这些选项即可控制使用。</p>
<table>
<thead>
<tr>
<th>开关选项</th>
<th>输出的日志级别</th>
</tr>
</thead>
<tbody>
<tr>
<td>无选项</td>
<td>LIFECYCLE及其更高级别</td>
</tr>
<tr>
<td>-q或者 —quiet</td>
<td>QUIET及其更高级别</td>
</tr>
<tr>
<td>-i 或者 —info</td>
<td>INFO及其更高级别</td>
</tr>
<tr>
<td>-d or —debug</td>
<td>DEBUG及其更高级别，这一般会输出所有日志</td>
</tr>
</tbody>
</table>
<h4 id="输出错误堆栈信息">输出错误堆栈信息</h4><p>在使用Gradle构建的时候，难免会有这样或者那样的问题导致你的构建失败，这时就需要你根据日志分析解决问题。除了以上的日志信息之外，Gradle还提供了堆栈信息的打印，用过Java语言的相信大家都会很熟悉错误堆栈信息，他能帮助我们很好的定位和分析问题。</p>
<p>默认情况下，堆栈信息的输出是关闭的，需要我们通过命令行的堆栈信息开关打开它，这样在我们构建失败的时候，Gradle才会输出错误堆栈信息，便于我们定位分析和解决问题。</p>
<table>
<thead>
<tr>
<th>命令行选项</th>
<th>用于</th>
</tr>
</thead>
<tbody>
<tr>
<td>无选项</td>
<td>没有堆栈信息输出</td>
</tr>
<tr>
<td>-s 或者 —stacktrace</td>
<td>输出关键性的堆栈信息</td>
</tr>
<tr>
<td>-S 或者—full-stacktrace</td>
<td>输出全部堆栈信息</td>
</tr>
</tbody>
</table>
<p>一般推荐使用-s而不是-S，因为-S输出的堆栈太多太长，非常不好看，而-s反而比较精简，可以定位解决我们大部分的问题。</p>
<h4 id="自己使用日志信息调试">自己使用日志信息调试</h4><p>在编写Gradle脚本的过程中，我们有时候需要输出一些日志，来验证我们的逻辑或者一些变量的值是否正确，这时候我们就可以使用Gradle提供的日志功能。</p>
<p>通常情况下我们一般都是使用print系列方法，把日志信息输出到标准的控制台输出流（它被Gradle定向为QUIET级别日志）。<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">println<span class="string">'输出一段日志信息'</span></span><br></pre></td></tr></table></figure></p>
<p>除了print系列方法之外，你也可以使用内置的logger更灵活的控制输出不同级别的日志信息。<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">logger.quiet(<span class="string">'quiet日志信息.'</span>)</span><br><span class="line">logger.error(<span class="string">'error日志信息.'</span>)</span><br><span class="line">logger.warn(<span class="string">'warn日志信息.'</span>)</span><br><span class="line">logger.lifecycle(<span class="string">'lifecycle日志信息.'</span>)</span><br><span class="line">logger.info(<span class="string">'info日志信息.'</span>)</span><br><span class="line">logger.debug(<span class="string">'debug日志信息.'</span>)</span><br></pre></td></tr></table></figure></p>
<p>logger说是内置，这里其实是调用的Project的getLogger()方法获取的Logger对象的实例。</p>
<h3 id="Gradle命令行">Gradle命令行</h3><p>Gradle命令行单独抽出来一小结的目的是想提倡大家尽可能的使用命令行，而不要太依赖于各种IDE，虽然IDE很方便，但是如果你换了一家公司，不适用这个IDE呢？如果让你做自动构建呢？可是没有IDE给你用的，全部都是基于命令行的。这个就像我们第一次学习变成语言时老师没说让你用IDE，而是直接用记事本或者其他文本工具写，目的就是让我们不要太依赖第三方工具，这种才能不变应万变。那么IDE该不该用，有没有必要，这个是肯定的，一定要用，因为他能提高你工作效率，但是用之前你要知道不借助IDE如果做一件事件，比如执行Gradle一个Task，在Android Studio下很简单，双击那个Task就可以执行了，但是如果没有Android Studio，你也要知道如何在命令行下如何运行它。我们要知其所以然，不然你再做几年也是这样啦。</p>
<h4 id="记得使用帮助">记得使用帮助</h4><p>命令行下的工具都有命令，刚开始我们不会用或者不知道有什么命令或者参数，这没事，但是我们可以通过帮助来了解，基本上所有的命令行工具都有帮助，查看帮助的方式也很简单，基本上都是在命令后跟-h或者—help，有的时候会有-?,以Gradle Wrapper为例：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew -?&#10;./gradlew -h&#10;./gradlew --help</span><br></pre></td></tr></table></figure></p>
<h4 id="查看所有可执行的Tasks">查看所有可执行的Tasks</h4><p>有时候我们不知道如何构建一个功能，不知道执行哪个Task，这时候就需要查看哪些Task可执行，都具备什么功能，通过运行./gradlew tasks命令，输出如下：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:tasks&#10;     &#10;------------------------------------------------------------&#10;All tasks runnable from root project&#10;------------------------------------------------------------&#10;     &#10;Build Setup tasks&#10;-----------------&#10;init - Initializes a new Gradle build. [incubating]&#10;wrapper - Generates Gradle wrapper files. [incubating]&#10;     &#10;Help tasks&#10;----------&#10;components - Displays the components produced by root project &#39;flysnow&#39;. [incubating]&#10;dependencies - Displays all dependencies declared in root project &#39;flysnow&#39;.&#10;dependencyInsight - Displays the insight into a specific dependency in root project &#39;flysnow&#39;.&#10;help - Displays a help message.&#10;model - Displays the configuration model of root project &#39;flysnow&#39;. [incubating]&#10;projects - Displays the sub-projects of root project &#39;flysnow&#39;.&#10;properties - Displays the properties of root project &#39;flysnow&#39;.&#10;tasks - Displays the tasks runnable from root project &#39;flysnow&#39;.&#10;     &#10;To see all tasks and more detail, run gradle tasks --all&#10;     &#10;To see more detail about a task, run gradle help --task &#60;task&#62;&#10;     &#10;BUILD SUCCESSFUL&#10;     &#10;Total time: 2.321 secs&#10;     &#10;This build could be faster, please consider using the Gradle Daemon: http://gradle.org/docs/2.5/userguide/gradle_daemon.html</span><br></pre></td></tr></table></figure></p>
<p>从输出我们可以看到，Gradle会以分组的方式列出Task列表，比如构建类的有init，wrapper；帮助类的有help、tasks等。</p>
<h4 id="gradle_help_任务">gradle help 任务</h4><p>除了上面我们说的每个命令行都有帮助外，Gradle还内置了一个help task，这个help可以让我们了解每一个task的使用帮助，用法是 ./gradlew help —task <task name="">，比如 ./gradlew help —task tasks，就可以显示tasks任务的帮助信息：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:help&#10;Detailed task information for tasks&#10;    &#10;Path&#10;     :tasks&#10;    &#10;Type&#10;     TaskReportTask (org.gradle.api.tasks.diagnostics.TaskReportTask)&#10;    &#10;Options&#10;     --all     Show additional tasks and detail.&#10;    &#10;Description&#10;     Displays the tasks runnable from root project &#39;android-gradle-book-code&#39; (some of the displayed tasks may belong to subprojects).&#10;    &#10;Group&#10;     help&#10;    &#10;BUILD SUCCESSFUL</span><br></pre></td></tr></table></figure></task></p>
<p>从帮助信息我们可以看到这个task有什么用，他是什么类型，属于哪个分组，有哪些可以使用的参数，比如这里就有—all参数，可以查看很多额外的详细信息。</p>
<h4 id="强制刷新依赖">强制刷新依赖</h4><p>我们一个功能不可避免的会依赖很多第三方库，像Maven这类工具都是有缓存的，因为不可能每次编译的时候都要重新下载第三方库，缓存就是这个目的，先使用缓存，没有再下载。默认情况下Maven这类工具会控制缓存的更新，但是也有例外，比如Version一样，但是里面的代码变了；还有就是联调测试时使用的snapshot版本。上两种情况我们在实际项目中都遇到过，最后就是通过强制刷新解决的。强制刷新很简单，只要在命令行运行的时候加上—refresh-dependencies参数就可以，这是IDE很难做到的（需要你了解配置），所以命令行的优势就体现出来了，非常简单。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew --refresh-dependencies assemble</span><br></pre></td></tr></table></figure></p>
<p>其他还有很多有用的命令、参数以及Tasks，就不一一介绍了，大家可以通过上面讲的两种帮助方法来了解熟悉。</p>
<h4 id="多任务调用">多任务调用</h4><p>有时候我们需要同事运行多个任务，比如在执行Jar之前先进行clean，那么我们就需要先执行clean对class文件清理，然后再执行jar生成一个jar包。通过命令行执行多个任务非常简单，只需要按顺序以空格分开即可，比如./gradlew clean jar，这样就可以了，有更多的任务时，可以继续添加。</p>
<h4 id="通过任务名字缩写执行执行">通过任务名字缩写执行执行</h4><p>有的时候我们的任务名字很长，如果在执行的时候全部写一遍也挺费时间，为此Gradle提供了基于驼峰命名法的缩写调用，比如connectCheck，我们执行的时候可以使用./gradlew connectCheck,也可以使用./gradlew cc这样的方式来执行。</p>
<p>以上内容节选自《Android Gradle权威指南》，更多关于《Android Gradle权威指南》的内容请参见<a href="http://yuedu.baidu.com/ebook/14a722970740be1e640e9a3e" target="_blank" rel="external">http://yuedu.baidu.com/ebook/14a722970740be1e640e9a3e</a></p>
</div><div class="tags"><a href="/tags/Android/">Android</a><a href="/tags/Gradle/">Gradle</a></div><div class="post-nav"><a href="/2016/05/22/groovy-basis.html" class="pre"><i class="icon-previous">Groovy基础</i></a><a href="/2015/08/13/android-tech-docs-support-annotations.html" class="next">Android注解支持(Support Annotations)<i class="icon-next"></i></a></div><div data-thread-key="2016/04/11/android-gradle-getting-started.html" data-title="Android Gradle 入门" data-url="http://www.flysnow.org/2016/04/11/android-gradle-getting-started.html" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2016/04/11/android-gradle-getting-started.html" data-title="Android Gradle 入门" data-url="http://www.flysnow.org/2016/04/11/android-gradle-getting-started.html" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search" class="search-form-input"/><input type="hidden" name="sitesearch" value="http://www.flysnow.org"/></form></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/05/22/groovy-basis.html">Groovy基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/11/android-gradle-getting-started.html">Android Gradle 入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/13/android-tech-docs-support-annotations.html">Android注解支持(Support Annotations)</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/06/android-tech-docs-tools-attributes.html">Android技术文档翻译--工具属性(Tools Attributes)</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/08/03/android-tech-docs-ant-tasks.html">android技术文档翻译--ant任务</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/03/30/manage-your-android-project-with-gradle.html">使用Gradle管理你的Android Studio工程</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/03/19/android-process-application-init-databases-problem.html">Android多进程的数据库访问问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/03/10/github-page-with-hexo.html">使用Hexo在Github上搭建自己的博客</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/01/12/android-gradle-plugin-translate-done.html">Android Gradle插件中文指南</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/07/13/effective-programming-more-than-writing-code.html">高效能程序员的修炼</a></li></ul></div><div class="widget"><div class="comments-title">最近评论</div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Gradle/">Gradle</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Gradle/">Gradle</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/软件开发/">软件开发</a></li></ul></div><div class="widget"><div class="widget-title">标签</div><div class="tagcloud"><a href="/tags/Ubuntu/" style="font-size: 15px;">Ubuntu</a><a href="/tags/Android/" style="font-size: 15px;">Android</a><a href="/tags/Ant/" style="font-size: 15px;">Ant</a><a href="/tags/数据库/" style="font-size: 15px;">数据库</a><a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a><a href="/tags/Github/" style="font-size: 15px;">Github</a><a href="/tags/翻译/" style="font-size: 15px;">翻译</a><a href="/tags/软件开发/" style="font-size: 15px;">软件开发</a><a href="/tags/Apache/" style="font-size: 15px;">Apache</a><a href="/tags/Linux/" style="font-size: 15px;">Linux</a><a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a><a href="/tags/PHP/" style="font-size: 15px;">PHP</a><a href="/tags/Gradle/" style="font-size: 15px;">Gradle</a><a href="/tags/开源/" style="font-size: 15px;">开源</a><a href="/tags/Http/" style="font-size: 15px;">Http</a><a href="/tags/HttpClitent/" style="font-size: 15px;">HttpClitent</a><a href="/tags/API/" style="font-size: 15px;">API</a><a href="/tags/Widget/" style="font-size: 15px;">Widget</a><a href="/tags/goagent/" style="font-size: 15px;">goagent</a><a href="/tags/代理/" style="font-size: 15px;">代理</a><a href="/tags/翻墙/" style="font-size: 15px;">翻墙</a><a href="/tags/Email/" style="font-size: 15px;">Email</a><a href="/tags/敏捷/" style="font-size: 15px;">敏捷</a><a href="/tags/软件工程/" style="font-size: 15px;">软件工程</a><a href="/tags/Intent/" style="font-size: 15px;">Intent</a></div></div><div class="widget"><div class="widget-title">友情链接</div><ul></ul><a href="http://yuedu.baidu.com/ebook/14a722970740be1e640e9a3e" title="Android Gradle权威指南" target="_blank">Android Gradle权威指南</a></div></div></div></div><div id="footer">© <a href="/." rel="nofollow">飞雪无情的博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script src="/js/jquery.min.js" type="text/javascript"></script>
<script src="/js/totop.js" type="text/javascript"></script><script src="/js/fancybox.pack.js" type="text/javascript"></script>
<script src="/js/jquery.fancybox.js" type="text/javascript"></script><link rel="stylesheet" href="/css/jquery.fancybox.css" type="text/css"><script>var duoshuoQuery = {short_name:'flysnow'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-44570956-1','auto');ga('send','pageview');
</script></div></body></html>